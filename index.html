<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼¢å­—å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        /* =========================================
           ã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³CSSã€‘
           ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–¢é€£ã¯å¤‰æ›´ãªã—
           ========================================= */
        :root {
            --ink-black: #000000;
            --main-font: "UD Digital Kyokasho N-R", "UD ãƒ‡ã‚¸ã‚¿ãƒ« æ•™ç§‘æ›¸ä½“ N-R", sans-serif;
        }

        body { 
            margin: 0; 
            font-family: var(--main-font); 
            background: #e0d8c3; 
            overflow: hidden; 
        }

        /* å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå¤‰æ›´ãªã—ãƒ»ç­”ãˆã¯å¼·åˆ¶è¡¨ç¤ºï¼‰ */
        @media print {
            @page { size: A4 landscape; margin: 0; }
            body { background: white !important; overflow: visible !important; }
            .view-header, #menu-screen { display: none !important; }
            .screen-overlay { position: static !important; background: white !important; }
            #view-mode-container { display: block !important; height: auto !important; padding: 0 !important; }
            .view-canvas { 
                width: 285mm !important; height: 185mm !important; margin: 5mm auto !important;
                border: 2px solid #000 !important; box-shadow: none !important; 
                page-break-after: always !important; 
            }
            .view-canvas:last-child { page-break-after: auto !important; }
            
            /* â˜…é‡è¦ï¼šå°åˆ·æ™‚ã¯éš ã—ã‚¯ãƒ©ã‚¹ï¼ˆblindï¼‰ã‚’ç„¡è¦–ã—ã¦å¼·åˆ¶è¡¨ç¤ºï¼†é»’å­— */
            .ans-text { color: black !important; opacity: 1 !important; visibility: visible !important; }
        }

        .screen-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #f0f0f0; z-index: 100;
        }

        .view-header {
            width: 100%; height: 50px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; box-sizing: border-box; background: #fff; border-bottom: 1px solid #ccc;
        }

        #view-mode-container {
            height: calc(100vh - 50px); display: flex; align-items: center; justify-content: center;
            padding: 10px; box-sizing: border-box; overflow-y: auto;
        }

        .view-canvas {
            display: flex; flex-direction: row-reverse;
            height: 96%; width: 96vw; max-width: 1600px;
            background: white; border: 2px solid #000;
            box-sizing: border-box; padding: 20px; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .kanji-table-grid {
            display: flex; flex-direction: row-reverse;
            height: 100%; flex-grow: 1; border: 1px solid #000; 
            overflow: hidden; box-sizing: border-box; background: #000; gap: 1px;
        }

        .column-unit { border-collapse: collapse; height: 100%; flex-grow: 1; table-layout: fixed; background: white; }
        .column-unit td { border: 1px solid #000; text-align: center; vertical-align: middle; padding: 0; box-sizing: border-box; }
        
        .h-check { height: 10%; }
        .h-num   { height: 6%; font-size: 1.4vh; }

        /* å•é¡Œæ–‡ã‚¨ãƒªã‚¢ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®è¦ãƒ»å¤‰æ›´ãªã—ï¼‰ */
        .h-ques { 
            height: 53%; writing-mode: vertical-rl; text-orientation: upright; text-align: left; 
            padding: 12px 2px; font-size: min(1.9vh, 17px); line-height: 1.4; vertical-align: middle; 
        }
        .ques-wrapper { display: block; width: 100%; height: 100%; text-align: left; }

        .h-num2  { height: 6%; font-size: 1.4vh; }
        
        /* === ç­”ãˆã‚¨ãƒªã‚¢ï¼ˆæ©Ÿèƒ½è¿½åŠ ï¼‰ === */
        .h-ans { 
            height: 25%; position: relative; 
            transition: background 0.1s; /* ã‚¯ãƒªãƒƒã‚¯æ™‚ã®åå¿œ */
        }
        /* é–²è¦§ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ã€ã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹æ„Ÿï¼ˆæŒ‡ãƒãƒ¼ã‚¯ï¼‰ã‚’å‡ºã™ */
        body.view-mode-active .h-ans { cursor: pointer; }
        body.view-mode-active .h-ans:hover { background-color: #fcfcfc; }
        body.view-mode-active .h-ans:active { background-color: #f0f0f0; }

        .ans-wrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            writing-mode: vertical-rl; text-orientation: upright;
            pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã‚’tdã«ä»»ã›ã‚‹ */
        }

        .ans-text { font-size: 2.3vh; font-weight: bold; color: #e74c3c; line-height: 1; transition: opacity 0.2s; }
        
        /* â˜…ç­”ãˆéš ã—ç”¨ã‚¯ãƒ©ã‚¹ */
        .ans-text.blind { opacity: 0; }

        .print-title {
            writing-mode: vertical-rl; font-weight: bold; border: 1px solid #000; border-left: 4px double #000;
            padding: 0 15px; display: flex; align-items: center; font-size: 1.3rem;
            height: 100%; margin-left: 15px; box-sizing: border-box; background: white;
        }

        .square { width: 20px; height: 20px; border: 1px solid #000; margin: auto; }
        .btn-action { padding: 6px 16px; border-radius: 20px; border: 1px solid #333; cursor: pointer; font-weight: bold; background: white; }
        .btn-action:hover { background: #f5f5f5; }
        .btn-action:disabled { opacity: 0.3; cursor: not-allowed; }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ç”¨ */
        #menu-screen {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; gap: 30px; background: #e0d8c3;
        }
        .menu-card {
            background: white; padding: 40px; border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center;
        }
        .select-box { padding: 12px; font-size: 1.1rem; width: 300px; margin-bottom: 20px; border: 2px solid #ccc; border-radius: 8px; }
        .btn-group { display: flex; gap: 15px; justify-content: center; }
        .btn-main { padding: 12px 25px; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; transition: 0.2s; }
        .btn-view { background: #3498db; }
        .btn-print { background: #27ae60; }
        .btn-main:hover { opacity: 0.8; transform: translateY(-2px); }
    </style>
</head>
<body>

<div id="menu-screen">
    <div class="menu-card">
        <h1 style="margin-top:0;">æ¼¢å­—å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ </h1>
        <p>å­¦ç¿’ã™ã‚‹ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        <select id="sheet-select" class="select-box">
            <option value="ï¼–å¹´ ã‚„ã¾ãªã—">ï¼–å¹´ ã‚„ã¾ãªã—</option>
            <option value="ï¼–å¹´ ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹">ï¼–å¹´ ã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹</option>
        </select>
        <div class="btn-group">
            <button class="btn-main btn-view" onclick="startApp('view')">ğŸ‘€ ç”»é¢ã§å­¦ç¿’</button>
            <button class="btn-main btn-print" onclick="startApp('print')">ğŸ–¨ï¸ PDF/å°åˆ·</button>
        </div>
    </div>
</div>

<div id="app-container" class="screen-overlay">
    <div class="view-header">
        <div style="display:flex; gap:10px;">
            <button class="btn-action" onclick="goBack()" style="background:#ff4757; color:white; border:none;">Ã— é–‰ã˜ã‚‹</button>
            <button id="toggle-all-btn" class="btn-action" onclick="toggleAllAnswers()">ğŸ‘ï¸ ç­”ãˆè¡¨ç¤º</button>
        </div>

        <div id="page-info" style="font-weight:bold;"></div>
        
        <div id="nav-controls">
            <button id="prevBtn" class="btn-action" onclick="changePage(-1)">â† å‰ã¸</button>
            <button id="nextBtn" class="btn-action" onclick="changePage(1)">æ¬¡ã¸ â†’</button>
        </div>
    </div>

    <div id="view-mode-container">
        </div>
</div>

<script>
    // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
    const allQuestions = Array.from({length: 60}, (_, i) => ({
        id: i + 1,
        q: `ç¬¬${i+1}å•ç›®ã®æ¼¢å­—ã€‚ã“ã‚Œã¯éå¸¸ã«é•·ã„æ–‡ç« ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚ï¼’è¡Œç›®ã‚‚ï¼‘æ–‡å­—ç›®ãŒæƒã†ã‹ç¢ºèªã€‚`,
        a: `æ­£è§£${i+1}`
    }));

    let currentPage = 0;
    const itemsPerPage = 15;
    let currentMode = 'view';
    let isAllAnswersVisible = false; // ä¸€æ‹¬è¡¨ç¤ºã®çŠ¶æ…‹ç®¡ç†

    function startApp(mode) {
        currentMode = mode;
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('app-container').style.display = 'block';
        
        const container = document.getElementById('view-mode-container');
        const sheetTitle = document.getElementById('sheet-select').value;
        container.innerHTML = '';

        if (mode === 'view') {
            document.body.classList.add('view-mode-active');
            currentPage = 0;
            isAllAnswersVisible = false; // ãƒšãƒ¼ã‚¸ã‚’é–‹ããŸã³ã«éš ã™
            updateToggleBtnText();
            
            document.body.style.overflow = 'hidden';
            document.getElementById('nav-controls').style.display = 'block';
            document.getElementById('toggle-all-btn').style.display = 'inline-block'; // ãƒœã‚¿ãƒ³è¡¨ç¤º
            renderViewPage();
        } else {
            document.body.classList.remove('view-mode-active');
            document.body.style.overflow = 'visible';
            document.getElementById('nav-controls').style.display = 'none';
            document.getElementById('toggle-all-btn').style.display = 'none'; // å°åˆ·æ™‚ã¯ãƒœã‚¿ãƒ³ä¸è¦
            document.getElementById('page-info').innerText = "å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼";
            renderAllPages();
            setTimeout(() => { window.print(); }, 500);
        }
    }

    // 1ãƒšãƒ¼ã‚¸ç”Ÿæˆé–¢æ•°
    function createPageCanvas(pageData, title) {
        const canvas = document.createElement('div');
        canvas.className = 'view-canvas';
        
        const titleDiv = document.createElement('div');
        titleDiv.className = 'print-title';
        titleDiv.innerText = title;
        canvas.appendChild(titleDiv);

        const grid = document.createElement('div');
        grid.className = 'kanji-table-grid';

        pageData.forEach(item => {
            // é–²è¦§ãƒ¢ãƒ¼ãƒ‰ãªã‚‰æœ€åˆã¯ã€Œblindã€ã‚¯ãƒ©ã‚¹ã‚’ã¤ã‘ã‚‹ã€‚å°åˆ·ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ã¤ã‘ãªã„ã€‚
            const hiddenClass = (currentMode === 'view' && !isAllAnswersVisible) ? 'blind' : '';
            
            // é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã®ã¿ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆä»˜ä¸
            const clickAction = (currentMode === 'view') ? `onclick="toggleSingleAnswer(this)"` : '';

            const table = document.createElement('table');
            table.className = "column-unit";
            table.innerHTML = `
                <tr><td class="h-check"><div class="square"></div></td></tr>
                <tr><td class="h-num">${item.id}</td></tr>
                <td class="h-ques">
                    <div class="ques-wrapper">${item.q}</div>
                </td>
                <tr><td class="h-num2">${item.id}</td></tr>
                <td class="h-ans" ${clickAction}>
                    <div class="ans-wrapper">
                        <span class="ans-text ${hiddenClass}">${item.a}</span>
                    </div>
                </td>
            `;
            grid.appendChild(table);
        });

        canvas.appendChild(grid);
        return canvas;
    }

    // â˜…å€‹åˆ¥ã‚¯ãƒªãƒƒã‚¯ã§ç­”ãˆã‚’è¡¨ç¤º/éè¡¨ç¤º
    function toggleSingleAnswer(tdElement) {
        const span = tdElement.querySelector('.ans-text');
        if (span) {
            span.classList.toggle('blind');
        }
    }

    // â˜…å…¨è¡¨ç¤º/å…¨éè¡¨ç¤ºãƒœã‚¿ãƒ³
    function toggleAllAnswers() {
        isAllAnswersVisible = !isAllAnswersVisible;
        
        // ç”»é¢å†…ã®ã™ã¹ã¦ã®ç­”ãˆè¦ç´ ã‚’å–å¾—
        const allSpans = document.querySelectorAll('.ans-text');
        allSpans.forEach(span => {
            if (isAllAnswersVisible) {
                span.classList.remove('blind');
            } else {
                span.classList.add('blind');
            }
        });
        updateToggleBtnText();
    }

    function updateToggleBtnText() {
        const btn = document.getElementById('toggle-all-btn');
        btn.innerText = isAllAnswersVisible ? 'ğŸ™ˆ ç­”ãˆã‚’éš ã™' : 'ğŸ‘ï¸ ç­”ãˆè¡¨ç¤º';
        // è‰²ã‚‚å¤‰ãˆã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„
        btn.style.background = isAllAnswersVisible ? '#333' : '#fff';
        btn.style.color = isAllAnswersVisible ? '#fff' : '#333';
    }

    function renderViewPage() {
        const container = document.getElementById('view-mode-container');
        container.innerHTML = '';
        const start = currentPage * itemsPerPage;
        const pageData = allQuestions.slice(start, start + itemsPerPage);
        const sheetTitle = document.getElementById('sheet-select').value;

        // ãƒšãƒ¼ã‚¸ã‚ãã‚Šæ™‚ã€ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã«åˆã‚ã›ã¦ç­”ãˆã‚’ç”Ÿæˆ
        container.appendChild(createPageCanvas(pageData, sheetTitle));

        document.getElementById('page-info').innerText = `${start + 1} ã€œ ${Math.min(start + itemsPerPage, allQuestions.length)} å•ç›®`;
        document.getElementById('prevBtn').disabled = currentPage === 0;
        document.getElementById('nextBtn').disabled = (start + itemsPerPage) >= allQuestions.length;
    }

    function renderAllPages() {
        const container = document.getElementById('view-mode-container');
        const sheetTitle = document.getElementById('sheet-select').value;
        const totalPages = Math.ceil(allQuestions.length / itemsPerPage);
        for (let i = 0; i < totalPages; i++) {
            const pageData = allQuestions.slice(i * itemsPerPage, (i + 1) * itemsPerPage);
            container.appendChild(createPageCanvas(pageData, sheetTitle));
        }
    }

    function changePage(step) {
        currentPage += step;
        // ãƒšãƒ¼ã‚¸ã‚’ã‚ãã‚‹ã¨ãã¯ã€Œéš ã™ã€çŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã ãŒã€
        // ä»Šã®çŠ¶æ…‹ï¼ˆå…¨è¡¨ç¤ºä¸­ãªã‚‰æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚‚å…¨è¡¨ç¤ºï¼‰ã‚’ç¶­æŒã—ãŸã‘ã‚Œã°ã“ã®ã¾ã¾ã§OKã€‚
        // ã“ã“ã§ã¯ã€Œã‚ãã£ãŸã‚‰ä¸€æ—¦éš ã™ã€æ–¹ãŒå­¦ç¿’ã‚¢ãƒ—ãƒªã£ã½ã„ã®ã§ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚
        isAllAnswersVisible = false; 
        updateToggleBtnText();
        
        renderViewPage();
    }

    function goBack() {
        document.getElementById('menu-screen').style.display = 'flex';
        document.getElementById('app-container').style.display = 'none';
        document.body.style.overflow = 'hidden';
        document.body.classList.remove('view-mode-active');
    }
</script>
</body>
</html>
